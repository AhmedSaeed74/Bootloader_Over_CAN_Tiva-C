/*
 * Flash_can.c
 *
 *  Created on: Sep 30, 2023
 *      Author: GPU_Tech
 */



/**
 * main.c
 */

#include <stdbool.h>
#include <stdint.h>
#include "sender.h"
#include "Flash_can.h"

//
//const uint8_t code[] = { 0x00, 0x02, 0x00, 0x20, 0xe7, 0x04, 0x02, 0x00, 0xed, 0x04, 0x02, 0x00, 0xef, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04,
//                         0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
//                         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04,
//                         0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0xf1, 0x04, 0x02, 0x00, 0x2d, 0xe9, 0xf0, 0x47, 0x84, 0x46, 0x1f, 0x46, 0x56, 0x48, 0xdf, 0xf8, 0x54, 0x91, 0xdf, 0xf8, 0x58, 0x81, 0x03, 0x68, 0x09, 0xea, 0x03, 0x03, 0x98, 0x45, 0x1b, 0xd0, 0x00, 0x24, 0x4f, 0xf0, 0x01, 0x0a, 0x4f, 0xf0, 0x03, 0x0e, 0x0a, 0xfa, 0x04, 0xf3, 0x19, 0x42, 0x0f, 0xd0, 0xdc, 0xf8, 0xc4, 0x3f, 0x66, 0x00, 0x0e, 0xfa, 0x06, 0xf5, 0xab, 0x43, 0xcc, 0xf8, 0xc4, 0x3f, 0xdc, 0xf8, 0xc4, 0x5f, 0xc2, 0xf3, 0x41, 0x13, 0xb3, 0x40, 0x2b, 0x43, 0xcc, 0xf8, 0xc4, 0x3f, 0x64, 0x1c, 0x08, 0x2c, 0xe8, 0xdb, 0x53, 0x08, 0x27, 0xbf, 0xdc, 0xf8, 0x00, 0x35, 0x0b, 0x43, 0xdc, 0xf8, 0x00, 0x35, 0x8b, 0x43, 0xcc, 0xf8, 0x00, 0x35, 0x93, 0x08, 0x27, 0xbf, 0xdc, 0xf8,
//                         0x04, 0x35, 0x0b, 0x43, 0xdc, 0xf8, 0x04, 0x35, 0x8b, 0x43, 0xcc, 0xf8, 0x04, 0x35, 0xd3, 0x08, 0x27, 0xbf, 0xdc, 0xf8, 0x08, 0x35, 0x0b, 0x43, 0xdc, 0xf8, 0x08, 0x35, 0x8b, 0x43, 0xcc, 0xf8, 0x08, 0x35, 0x13, 0x09, 0x27, 0xbf, 0xdc, 0xf8, 0x18, 0x35, 0x0b, 0x43, 0xdc, 0xf8, 0x18, 0x35, 0x8b, 0x43, 0xcc, 0xf8, 0x18, 0x35, 0x03, 0x68, 0x4c, 0x46, 0x45, 0x46, 0x23, 0x40, 0x9d, 0x42, 0x09, 0xd0, 0x52, 0x09, 0x27, 0xbf, 0xdc, 0xf8, 0x3c, 0x25, 0x0a, 0x43, 0xdc, 0xf8, 0x3c, 0x25, 0x8a, 0x43, 0xcc, 0xf8, 0x3c, 0x25, 0x7a, 0x08, 0x27, 0xbf, 0xdc, 0xf8, 0x0c, 0x25, 0x0a, 0x43, 0xdc, 0xf8, 0x0c, 0x25, 0x8a, 0x43, 0xcc, 0xf8, 0x0c, 0x25, 0xba, 0x08, 0x27, 0xbf, 0xdc, 0xf8, 0x10, 0x25, 0x0a, 0x43, 0xdc, 0xf8, 0x10, 0x25, 0x8a, 0x43, 0xcc, 0xf8, 0x10, 0x25, 0xfa, 0x08, 0x27, 0xbf, 0xdc, 0xf8, 0x14, 0x25, 0x0a, 0x43, 0xdc, 0xf8, 0x14, 0x25, 0x8a, 0x43, 0xcc, 0xf8, 0x14, 0x25, 0x3a, 0x09, 0x27, 0xbf, 0xdc, 0xf8, 0x1c, 0x25, 0x0a, 0x43, 0xdc, 0xf8, 0x1c, 0x25, 0x8a, 0x43, 0xcc, 0xf8, 0x1c, 0x25, 0x00, 0x68, 0x04, 0x40, 0xa5, 0x42, 0x14, 0xd0, 0xb8, 0x0a, 0x27, 0xbf, 0xdc, 0xf8, 0x44, 0x05, 0x08, 0x43,
//                         0xdc, 0xf8, 0x44, 0x05, 0x88, 0x43, 0x17, 0xf4, 0x40, 0x7f, 0xcc, 0xf8, 0x44, 0x05, 0x19, 0xbf, 0xdc, 0xf8, 0x40, 0x05, 0x08, 0x43, 0xdc, 0xf8, 0x40, 0x05, 0x88, 0x43, 0xcc, 0xf8, 0x40, 0x05, 0x00, 0x2f, 0x19, 0xbf, 0xdc, 0xf8, 0x28, 0x05, 0x20, 0xea, 0x01, 0x01, 0xdc, 0xf8, 0x28, 0x05, 0x01, 0x43, 0xcc, 0xf8, 0x28, 0x15, 0xbd, 0xe8, 0xf0, 0x87, 0x00, 0x00, 0xff, 0x70, 0x00, 0xe0, 0x0f, 0x40, 0x00, 0x00, 0x05, 0x10, 0x0e, 0xb5, 0x15, 0x48, 0x00, 0xf0, 0x30, 0xf8, 0x14, 0x48, 0x0e, 0x21, 0x00, 0xf0, 0x72, 0xf8, 0x12, 0x48, 0x0e, 0x21, 0x00, 0x22, 0x00, 0xf0, 0x80, 0xf8, 0x11, 0x48, 0x00, 0x88, 0xad, 0xf8, 0x00, 0x00, 0x00, 0x20, 0x8d, 0xf8, 0x04, 0x00, 0x9d, 0xf8, 0x04, 0x00, 0x00, 0xeb, 0xd0, 0x71, 0x21, 0xf0, 0x01, 0x01, 0x40, 0x1a, 0x8d, 0xf8, 0x04, 0x00, 0x9d, 0xf8, 0x04, 0x00, 0x10, 0xf8, 0x0d, 0x20, 0x41, 0x1c, 0x05, 0x48, 0x8d, 0xf8, 0x04, 0x10, 0x0e, 0x21, 0x00, 0xf0, 0x65, 0xf8, 0x04, 0x48, 0x00, 0xf0, 0x65, 0xf8, 0xe7, 0xe7, 0x05, 0x08, 0x00, 0xf0, 0x00, 0x50, 0x02, 0x40, 0x06, 0x05, 0x02, 0x00, 0x40, 0x4b, 0x4c, 0x00, 0x0b, 0x4a, 0xc1, 0x08, 0xc0, 0xf3, 0x07, 0x23, 0x01, 0xf4,
//                         0xff, 0x51, 0x00, 0xf0, 0xff, 0x00, 0xa1, 0xf5, 0x50, 0x31, 0xd2, 0x18, 0x21, 0xf0, 0x7e, 0x41, 0x12, 0x0f, 0x41, 0xea, 0x02, 0x71, 0x01, 0x22, 0x41, 0xea, 0x80, 0x01, 0x41, 0xf0, 0x00, 0x70, 0x02, 0x60, 0x70, 0x47, 0xc0, 0x46, 0x00, 0xe6, 0x0f, 0x40, 0x53, 0x08, 0x27, 0xbf, 0xd0, 0xf8, 0x00, 0x34, 0x0b, 0x43, 0xd0, 0xf8, 0x00, 0x34, 0x8b, 0x43, 0x92, 0x08, 0xc0, 0xf8, 0x00, 0x34, 0x27, 0xbf, 0xd0, 0xf8, 0x20, 0x24, 0x11, 0x43, 0xd0, 0xf8, 0x20, 0x24, 0x22, 0xea, 0x01, 0x01, 0xc0, 0xf8, 0x20, 0x14, 0x70, 0x47, 0x08, 0x48, 0x80, 0xf3, 0x08, 0x88, 0x08, 0x49, 0x08, 0x68, 0x40, 0xf4, 0x70, 0x00, 0x08, 0x60, 0x00, 0xbf, 0x00, 0xbf, 0x00, 0xf0, 0x23, 0xf8, 0x00, 0x20, 0xff, 0xf7, 0x8d, 0xff, 0x01, 0x20, 0x00, 0xf0, 0x1f, 0xf8, 0x00, 0x02, 0x00, 0x20, 0x88, 0xed, 0x00, 0xe0, 0x38, 0xb5, 0x01, 0x22, 0x0c, 0x46, 0x05, 0x46, 0x08, 0x23, 0xff, 0xf7, 0xc9, 0xfe, 0x01, 0x22, 0x21, 0x46, 0x28, 0x46, 0xff, 0xf7, 0xc8, 0xff, 0x38, 0xbd, 0xff, 0xf7, 0xdb, 0xbf, 0x70, 0x47, 0xfe, 0xe7, 0xfe, 0xe7, 0xfe, 0xe7, 0x40, 0xf8, 0x21, 0x20, 0x70, 0x47, 0x40, 0x1e, 0xfd, 0xd1, 0x70, 0x47, 0x01, 0x20, 0x70, 0x47,
//                         0x00, 0xbf, 0xfe, 0xe7, 0x08, 0x00};
//


extern uint32_t g_ui32MsgCount ;
extern bool g_bErrFlag ;
void Download_array_to_can(uint8_t* code , uint32_t code_size)
{
    uint32_t command = 0x13;



    /* send command to start programming session*/
    send_message( 3 , ((uint8_t *)&command));
    while(1)
    {

        /* send code size */
        if(g_bErrFlag == 0 && g_ui32MsgCount == 1)
        {
            /* send code size */
            send_message( 1 , ((uint8_t *)&code_size));
        }
        /* send code */
        else if(g_bErrFlag == 0 && g_ui32MsgCount >= 2 )
        {
            uint32_t counter = 0 ;
            for(counter = 0 ; counter < code_size/4 ; counter++)
            {
                /* send 4 bytes of code each iteration*/
                send_message( 2 , ((uint8_t *)&code[counter*4]));
            }
            break;
        }
        else
        {
            /* Do nothing */
        }
    }
}
